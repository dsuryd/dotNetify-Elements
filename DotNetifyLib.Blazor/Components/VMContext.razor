@using DotNetify.Blazor
@implements IDisposable
@typeparam TState
@inject IVMProxy<TState> vm

<d-vm-context ref="vm.ElementRef" vm="@VM">
    @ChildContent
</d-vm-context>

@functions {
    [Parameter] protected string VM { get; set; }
    [Parameter] protected RenderFragment ChildContent { get; set; }
    [Parameter] protected Action<TState> OnStateChanged { get; set; }

    protected override async Task OnAfterRenderAsync()
    {
        await vm.HandleStateChangedAsync((sender, e) => OnStateChanged?.Invoke(e));
    }

    public async Task DispatchAsync(string propertyName, object propertyValue = null)
    {
        await vm.DispatchAsync(propertyName, propertyValue);
    }

    public void Dispose()
    {
        vm.Dispose();
    }
}